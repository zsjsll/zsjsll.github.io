---
title: linux-后台运行
date: 2017-11-02 15:03:18
categories:
tags:
- linux
- screen
- 守护进程
---

很多时候我们希望在后台运行一些程序，方便我们查看，监控或者开启一些服务，但是如果是在终端中启动的程序，一旦终端被关闭，程序也就终止了，而且如果是给反馈的程序，我们的终端就需要一直开启，不能进行其他操作，如果需要进行其他操作，需要重新打开一个终端这样非常不便于远程ssh链接服务器进行操作。
<!--more-->

# 干货

不解释了，快上车！
``` bash
screen -Smd <name> <command>       #用就可以了，不要问为什么
```



# nohup和& 

语法：`nohup <程序> &`

## &

在应用Unix/Linux时，我们一般想让某个程序在后台运行，于是我们将常会用 & 在程序结尾来让程序自动运行。比如我们要运行mysql在后台： `/usr/local/mysql/bin/mysqld_safe –user=mysql &`。

>虽然可以进入后台，但是一旦退出终端，这个程序还是会被终止。

## nohup

如果你正在运行一个进程，而且你觉得在退出帐户时该进程还不会结束，那么可以使用nohup命令。该命令可以在你退出帐户/关闭终端之后继续运行相应的进程。nohup就是不挂起的意思(no hang up)。还可以把一些具有输出的程序，输出内容重定向。

`nohup /root/start.sh &`
在shell中回车后提示：
``` bash
[~]$ appending output to nohup.out
```
>原程序的的标准输出被自动改向到当前目录下的nohup.out文件，起到了log的作用。
即使退出终端，这个程序也依然在运行。

# 控制后台

``` bash
jobs          #查看当前有多少在后台运行的命令
fg            #将后台中的命令调至前台继续运行
bg            #将一个在后台暂停的命令，变成继续执行
ctrl + z      #可以将一个正在前台执行的命令放到后台，并且暂停
```

# screen

我们经常需要 SSH 或者 telent 远程登录到 Linux 服务器，为一些长时间运行的任务而头疼，比如系统备份、ftp 传输等等。通常情况下都是为每一个这样的任务开一个远程终端窗口，因为他们执行的时间太长了。必须等待它执行完毕，在此期间可不能关掉窗口或者断开连接，否则这个任务就会被杀掉，一切半途而废了。
虽然nohup很容易使用，但还是比较“简陋”的，对于简单的命令能够应付过来，对于复杂的需要人机交互的任务就麻烦了。
其实我们可以使用一个更为强大的实用程序screen。

## 创建screen

创建指令 | 解释
-----|---
-c file | 使用配置文件file，而不使用默认的$HOME/.screenrc
-d -D [pid.tty.host] | 不开启新的screen会话，而是断开其他正在运行的screen会话
-h num | 指定历史回滚缓冲区大小为num行
**-ls** | 列出现有screen会话，格式为pid.tty.host
**-dm** | 启动一个开始就处于断开模式的会话
**-r [pid.tty.host]** | 重新连接一个断开的会话。多用户模式下连接到其他用户screen会话需要指定sessionowner，需要setuid-root权限
**-S &lt;name>** | 创建screen会话时为会话指定一个名字
-v | 显示screen版本信息
-wipe [match] | 同-list，但删掉那些无法连接的会话

## 操作screen

默认情况下，screen接收以C-a开始的命令。这种命令形式在screen中叫做键绑定（key binding），C-a叫做命令字符（command character）。

操作指令 | 解释
---|---
C-a ? | 显示所有键绑定信息
C-a w | 显示所有窗口列表
C-a C-a | 切换到之前显示的窗口
C-a c | 创建一个新的运行shell的窗口并切换到该窗口
C-a n | 切换到下一个窗口
C-a p | 切换到前一个窗口(与C-a n相对)
C-a 0..9 | 切换到窗口0..9
C-a a | 发送 C-a到当前窗口
C-a d | 暂时断开screen会话
C-a k | 杀掉当前窗口
C-a [ | 进入拷贝/回滚模式
